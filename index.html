<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zurich Takaful Info App</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg, #0d47a1, #1976d2);
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
    }
    select, button, input, textarea {
      padding: 10px 15px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
    }
    select {
      background: white;
      color: #0d47a1;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      margin: 15px auto;
      padding: 15px;
      width: 90%;
      max-width: 420px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    h2 { margin-top: 10px; }
    .produk-btn {
      display: block;
      background: white;
      color: #0d47a1;
      border-radius: 10px;
      margin: 10px auto;
      padding: 12px;
      width: 90%;
      font-weight: bold;
      transition: 0.2s;
    }
    .produk-btn:hover {
      background: #bbdefb;
      transform: scale(1.03);
    }
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      opacity: 0;
      transition: 0.3s;
      z-index: 1000;
    }
    .modal.show { visibility: visible; opacity: 1; }
    .modal-content {
      background: white;
      color: #0d47a1;
      border-radius: 15px;
      padding: 20px;
      width: 90%;
      max-width: 420px;
      text-align: left;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .close {
      float: right;
      font-weight: bold;
      cursor: pointer;
      color: #1976d2;
    }
    .close:hover { color: red; }
    footer {
      margin-top: 30px;
      font-size: 14px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <h1>ğŸ•Œ Waktu Solat & Cuaca</h1>

  <div class="card">
    <select id="negeriSelect">
      <option value="">-- Pilih Negeri --</option>
      <option>Johor</option>
      <option>Kedah</option>
      <option>Kelantan</option>
      <option>Melaka</option>
      <option>Negeri Sembilan</option>
      <option>Pahang</option>
      <option>Perak</option>
      <option>Perlis</option>
      <option>Pulau Pinang</option>
      <option>Sabah</option>
      <option>Sarawak</option>
      <option>Selangor</option>
      <option>Terengganu</option>
      <option>W.P. Kuala Lumpur</option>
      <option>W.P. Putrajaya</option>
      <option>W.P. Labuan</option>
    </select>

    <div id="solatBox" class="card">Sila pilih negeri untuk lihat waktu solat.</div>
    <div id="cuacaBox" class="card">Memuatkan cuaca...</div>
  </div>

  <div class="card">
    <h2>ğŸ’¼ Produk Zurich Takaful</h2>
    <button class="produk-btn" data-produk="zdrive">Z-Drive Assist</button>
    <button class="produk-btn" data-produk="zmotor">Z-Motor</button>
    <button class="produk-btn" data-produk="zrider">Z-Rider</button>
    <button class="produk-btn" data-produk="zpa">Personal Accident</button>
    <button class="produk-btn" data-produk="ztravel">Z-Travel</button>
    <button class="produk-btn" data-produk="zfirebiz">Fire Takaful (Business)</button>
  </div>

  <section id="quizSection" class="card">
    <h2>ğŸ¯ Kuiz Zurich Takaful</h2>
    <div id="quizBox">
      <p id="quizQuestion">Uji pengetahuan anda tentang takaful!</p>
      <div id="quizOptions"></div>
      <button id="startQuiz" class="produk-btn">Mula Kuiz</button>
    </div>
  </section>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <div id="produkInfo"></div>
    </div>
  </div>

  <footer>Â© <span id="year"></span> BroChat AzA Takaful Zurich</footer>

<script>
// ===================== TARIKH
document.getElementById("year").textContent = new Date().getFullYear();

// ===================== WAKTU SOLAT FIX (API)
async function getWaktuSolat(negeri) {
  const solatBox = document.getElementById("solatBox");
  solatBox.innerHTML = "â³ Memuatkan waktu solat...";

  const zoneCodes = {
    "Johor": "JHR01","Kedah": "KDH01","Kelantan": "KTN01","Melaka": "MLK01",
    "Negeri Sembilan": "NGS01","Pahang": "PHG01","Perak": "PRK01","Perlis": "PLS01",
    "Pulau Pinang": "PNG01","Sabah": "SBH01","Sarawak": "SWK01","Selangor": "SGR01",
    "Terengganu": "TRG01","W.P. Kuala Lumpur": "WLY01","W.P. Putrajaya": "WLY02","W.P. Labuan": "WLY03"
  };
  const zone = zoneCodes[negeri];
  if (!zone) return (solatBox.innerHTML = "âš ï¸ Zon negeri tidak dijumpai.");

  try {
    const res = await fetch(`https://corsproxy.io/?https://api.waktusolat.app/v2/solat/${zone}`);
    const data = await res.json();
    const w = data.prayerTime[0];
    const toTime = ts => new Date(ts * 1000).toLocaleTimeString("ms-MY", { hour: "2-digit", minute: "2-digit" });

    solatBox.innerHTML = `
      <h3>ğŸ“ ${data.zone}</h3>
      ğŸŒ… Subuh: ${toTime(w.fajr)}<br>
      â˜€ï¸ Syuruk: ${toTime(w.syuruk)}<br>
      ğŸ•Œ Zohor: ${toTime(w.dhuhr)}<br>
      ğŸŒ‡ Asar: ${toTime(w.asr)}<br>
      ğŸŒ† Maghrib: ${toTime(w.maghrib)}<br>
      ğŸŒƒ Isyak: ${toTime(w.isha)}<br>
      <small>ğŸ“… ${w.hijri}</small>
    `;
  } catch (err) {
    solatBox.innerHTML = "âŒ Gagal memuatkan waktu solat.";
  }
}

// ===================== CUACA
async function getCuaca(lat, lon) {
  const cuacaBox = document.getElementById("cuacaBox");
  try {
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m`);
    const cuaca = await res.json();
    const c = cuaca.current;
    const weatherDesc = weatherIcon(c.weather_code);
    cuacaBox.innerHTML = `
      ${weatherDesc.icon} ${weatherDesc.text}<br>
      ğŸŒ¡ï¸ Suhu: ${c.temperature_2m}Â°C<br>
      ğŸ’¨ Angin: ${c.wind_speed_10m} km/j
    `;
  } catch {
    cuacaBox.innerHTML = "âŒ Gagal memuatkan cuaca.";
  }
}

function weatherIcon(code) {
  const w = {0:["â˜€ï¸","Cerah"],1:["ğŸŒ¤ï¸","Sedikit berawan"],2:["â›…","Berawan"],3:["â˜ï¸","Mendung"],61:["ğŸŒ§ï¸","Hujan sederhana"],95:["â›ˆï¸","Ribut petir"]};
  return {icon:w[code]?.[0]||"ğŸŒ¡ï¸",text:w[code]?.[1]||"Cuaca tidak diketahui"};
}

// ===================== NEGERI PILIHAN
const negeriSelect = document.getElementById("negeriSelect");
negeriSelect.addEventListener("change", ()=>{
  const negeri = negeriSelect.value;
  const coords = {
    "Johor": [1.49,103.74],"Kedah": [6.12,100.37],"Kelantan": [6.12,102.24],
    "Melaka": [2.19,102.25],"Negeri Sembilan": [2.73,101.94],"Pahang": [3.81,103.33],
    "Perak": [4.59,101.09],"Perlis": [6.44,100.20],"Pulau Pinang": [5.41,100.33],
    "Sabah": [5.98,116.07],"Sarawak": [1.55,110.36],"Selangor": [3.07,101.52],
    "Terengganu": [5.33,103.14],"W.P. Kuala Lumpur": [3.14,101.69],
    "W.P. Putrajaya": [2.93,101.69],"W.P. Labuan": [5.28,115.23]
  };
  if (coords[negeri]) {
    getWaktuSolat(negeri);
    getCuaca(coords[negeri][0], coords[negeri][1]);
  }
});

// ===================== PRODUK INFO (Popup)
const produkInfo = {
  zdrive: "ğŸš— <b>Z-Drive Assist</b> menawarkan bantuan tepi jalan, towing & khidmat kecemasan 24 jam.",
  zmotor: "ğŸï¸ <b>Z-Motor</b> melindungi kenderaan anda daripada kemalangan, kecurian & kebakaran.",
  zrider: "ğŸ›µ <b>Z-Rider</b> untuk penunggang motosikal & skuter dengan perlindungan menyeluruh.",
  zpa: "ğŸ§ <b>Personal Accident (PA)</b> perlindungan diri 24/7 terhadap kemalangan & kecederaan.",
  ztravel: "ğŸ§³ <b>Z-Travel</b> perlindungan perjalanan dalam & luar negara â€“ kelewatan, kehilangan bagasi.",
  zfirebiz: "ğŸ¢ <b>Fire Takaful (Business)</b> melindungi premis perniagaan daripada kebakaran & kerugian aset."
};
const modal = document.getElementById("modal");
const modalContent = document.getElementById("produkInfo");
const closeModal = document.getElementById("closeModal");
document.querySelectorAll(".produk-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const info=btn.dataset.produk;
    if(produkInfo[info]){
      modalContent.innerHTML=produkInfo[info];
      modal.classList.add("show");
    }
  });
});
closeModal.onclick=()=>modal.classList.remove("show");

// ===================== KUIZ
const quizData=[
  {question:"Apakah perlindungan utama Z-Motor?",options:["Kemalangan, kebakaran & kecurian","Cermin depan sahaja","Takaful hayat"],answer:0},
  {question:"Z-Rider sesuai untuk siapa?",options:["Penunggang motosikal","Pemilik rumah","Peniaga restoran"],answer:0},
  {question:"Z-Drive Assist menawarkan bantuan apa?",options:["Bantuan tepi jalan & towing","Takaful nyawa"],answer:0}
];
let currentQuiz=0,score=0;
const quizBox=document.getElementById("quizBox");
const quizQ=document.getElementById("quizQuestion");
const quizO=document.getElementById("quizOptions");
const startBtn=document.getElementById("startQuiz");
function loadQuiz(){const q=quizData[currentQuiz];quizQ.textContent=q.question;quizO.innerHTML="";q.options.forEach((opt,i)=>{const b=document.createElement("button");b.textContent=opt;b.className="produk-btn";b.onclick=()=>checkAnswer(i);quizO.appendChild(b);});}
function checkAnswer(i){if(i===quizData[currentQuiz].answer)score++;currentQuiz++;if(currentQuiz<quizData.length)loadQuiz();else quizBox.innerHTML=`<h3>ğŸ‰ Kuiz Tamat!</h3><p>Skor anda: <b>${score}/${quizData.length}</b></p><button class='produk-btn' onclick='location.reload()'>Main Semula</button>`;}
startBtn.onclick=()=>{startBtn.style.display="none";loadQuiz();}
</script>
</body>
</html>
