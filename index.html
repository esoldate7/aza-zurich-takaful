<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AZA Zurich Takaful â€” Info & Fun</title>
  <style>
    :root{
      --blue1:#0d47a1; --blue2:#1976d2; --card-bg: rgba(255,255,255,0.08);
      --accent:#00bcd4;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Poppins,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background: linear-gradient(180deg,var(--blue1),var(--blue2));
      color:#fff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }
    .wrap{max-width:980px;margin:18px auto;padding:12px;}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    header .brand{display:flex;gap:10px;align-items:center}
    .logo {width:42px;height:42px;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;color:var(--blue1);font-weight:700}
    h1{font-size:18px;margin:0}
    p.lead{margin:2px 0 0 0;opacity:0.9;font-size:13px}

    /* cards */
    .card{background:var(--card-bg);border-radius:14px;padding:14px;margin-top:14px;box-shadow:0 6px 18px rgba(0,0,0,0.18)}
    .inline-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    select, button, input, textarea{font-size:15px;border-radius:10px;padding:10px;border:none;outline:none}
    select{background:white;color:var(--blue1)}
    button.cta{background:#fff;color:var(--blue1);font-weight:700;border-radius:10px;padding:10px 14px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff}

    /* product list */
    .produk-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:10px}
    .produk-card{background:rgba(255,255,255,0.06);padding:12px;border-radius:10px;cursor:pointer}
    .produk-card h4{margin:0 0 6px 0}
    .produk-card p{margin:0;font-size:13px;opacity:0.95}

    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1200;padding:18px}
    .modal.show{display:flex}
    .modal .box{width:100%;max-width:560px;background:#fff;color:var(--blue1);border-radius:12px;padding:18px;position:relative}
    .modal .close{position:absolute;right:12px;top:10px;font-size:18px;cursor:pointer}
    .modal h3{margin:0 0 8px 0}
    .modal p{margin:0 0 10px 0;color:#333}

    /* quiz */
    #quizSection .btn, .btn{cursor:pointer;border-radius:10px;padding:10px 14px;border:none}
    .quiz-options{display:flex;flex-direction:column;gap:8px;margin-top:10px}

    /* fruit modal fullscreen */
    #fruitModal{position:fixed;inset:0;background:linear-gradient(180deg,rgba(2,18,78,0.98),rgba(3,54,120,0.98));display:none;align-items:center;justify-content:center;z-index:1300}
    #fruitModal.show{display:flex}
    .fruit-wrap{width:100%;height:100%;display:grid;grid-template-rows:auto 1fr auto;}
    .fruit-top{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;color:#fff}
    #fruitCanvas{width:100%;height:calc(100vh - 140px);display:block;touch-action:none}
    .fruit-bottom{display:flex;gap:10px;justify-content:center;padding:12px}
    .fg-btn{padding:10px 14px;border-radius:10px;border:none;background:#fff;color:var(--blue1);font-weight:700;cursor:pointer}

    /* overlay game over */
    .fg-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.56);padding:18px;border-radius:12px;color:#fff;text-align:center;display:none}
    .fg-overlay.show{display:block}

    footer{margin-top:20px;text-align:center;opacity:0.85;font-size:13px}
    small.muted{opacity:0.8;font-size:12px;display:block;margin-top:8px}

    /* responsive */
    @media (max-width:640px){
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .logo{width:38px;height:38px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
  <div class="brand">
    <img src="./public/zurich_logo_takaful.png" alt="Zurich Takaful Logo" class="logo" />
    <div>
      <h1>AZA Zurich Takaful AM</h1>
      <p class="lead">Waktu solat, produk & hiburan ringan â€” semua di satu app</p>
    </div>
  </div>
  <div class="inline-row">
    <button id="openGamesBtn" class="ghost">ğŸ® Lite Games</button>
    <button id="openQuizBtn" class="ghost">ğŸ§  Kuiz</button>
  </div>
</header>

    <!-- ===== Waktu Solat & Cuaca ===== -->
    <section id="waktuCard" class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div style="flex:1;">
          <h3 style="margin:0 0 6px 0">ğŸ•Œ Waktu Solat Semasa</h3>
          <p style="margin:0;font-size:13px;opacity:0.95">Pilih negeri atau izinkan akses lokasi.</p>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="negeriSelect" aria-label="Pilih negeri">
            <option value="">-- Pilih Negeri --</option>
            <option value="WLY01">Kuala Lumpur</option>
            <option value="WLY02">Putrajaya</option>
            <option value="SGR01">Selangor</option>
            <option value="PNG01">Pulau Pinang</option>
            <option value="PRK01">Perak</option>
            <option value="JHR01">Johor</option>
            <option value="KTN01">Kelantan</option>
            <option value="KDH01">Kedah</option>
            <option value="MLK01">Melaka</option>
            <option value="NSN01">Negeri Sembilan</option>
            <option value="PHG01">Pahang</option>
            <option value="PLS01">Perlis</option>
            <option value="SBH01">Sabah</option>
            <option value="SWK01">Sarawak</option>
            <option value="TRG01">Terengganu</option>
            <option value="LBN01">Labuan</option>
          </select>
          <button id="btnDetect" class="cta">ğŸ“ Auto Detect</button>
        </div>
      </div>

      <div id="solatResult" style="margin-top:12px">Sila pilih negeri untuk paparan waktu solat.</div>
      <div id="cuacaResult" style="margin-top:10px;font-size:14px;opacity:0.95">Memuatkan cuacaâ€¦</div>
      <small class="muted">Sumber waktu solat: e-Solat (JAKIM). Cuaca: Open-Meteo.</small>
    </section>

    <!-- ===== Produk Zurich ===== -->
    <section id="produkCard" class="card">
      <h3>ğŸ’¼ Produk Zurich Takaful</h3>
      <div class="produk-grid" id="produkGrid">
        <!-- generated -->
      </div>
    </section>

    <!-- ===== Kuiz ===== -->
    <section id="quizSection" class="card">
      <h3>ğŸ¯ Kuiz Zurich Takaful</h3>
      <p style="margin:0 0 8px 0;font-size:13px">Uji pengetahuan anda â€” jawapan betul akan terus ke soalan seterusnya.</p>
      <div id="quizBox">
        <p id="quizQuestion" style="font-weight:700">Tekan "Mula Kuiz" untuk mula.</p>
        <div id="quizOptions" class="quiz-options"></div>
        <div style="margin-top:10px">
          <button id="startQuiz" class="cta">Mula Kuiz</button>
        </div>
      </div>
    </section>

    <!-- ===== Lite Games Launcher (still page scrollable) ===== -->

      <section id="lite-games" class="section">
  <h2>ğŸ® Lite Games</h2>

  <div class="game-switch">
    <button class="btn-switch" onclick="showGame('fruit')">ğŸ‰ Fruit Slice</button>
    <button class="btn-switch" onclick="showGame('balloon')">ğŸˆ Balloon Pop</button>
  </div>
<div id="fruit-game" class="game-area" style="display:none;"></div>
      <div id="balloon-game" class="game-area"
     style="display:none; position:relative; width:400px; height:400px; background:#222; overflow:hidden; border-radius:12px;">
</div>  
      </section>



    <footer>
      Â© <span id="year"></span> AZA Zurich Takaful AM â€” Dibina oleh BroChat AzA
    </footer>
  </div>

  <!-- ===== Modal Produk (info + request form) ===== -->
  <div id="modalProduk" class="modal" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true">
      <span class="close" id="closeProduk">&times;</span>
      <div id="produkInfoBox"></div>
      <hr />
      <form id="quoteForm">
        <h3>ğŸ§¾ Request Quotation</h3>
        <label>Nama penuh</label><br>
        <input id="q_nama" type="text" required placeholder="Contoh: Ahmad bin Ali" style="width:100%;margin-top:6px" />
        <label>No. Telefon</label><br>
        <input id="q_tel" type="tel" required placeholder="Contoh: 0123456789" style="width:100%;margin-top:6px" />
        <label>Email</label><br>
        <input id="q_email" type="email" required placeholder="email@contoh.com" style="width:100%;margin-top:6px" />
        <label>Mesej (optional)</label><br>
        <textarea id="q_msg" rows="3" style="width:100%;margin-top:6px"></textarea>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button type="submit" class="cta">ğŸ“² Hantar ke WhatsApp</button>
          <button type="button" id="cancelQuote" class="ghost">Batal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== Fruit Slice Modal Fullscreen ===== -->
  <div id="fruitModal" aria-hidden="true">
    <div class="fruit-wrap">
      <div class="fruit-top">
        <div style="font-weight:700">ğŸ‰ Fruit Slice â€” BroChat</div>
        <div style="font-weight:700">Skor: <span id="fgScore">0</span></div>
      </div>
      <canvas id="fruitCanvas"></canvas>
      <div class="fruit-bottom">
        <button id="fgPause" class="fg-btn">â¸ï¸ Jeda</button>
        <button id="fgRestart" class="fg-btn">ğŸ” Restart</button>
        <button id="fgClose" class="fg-btn">âœ– Tutup</button>
      </div>
      <div id="fgOverlay" class="fg-overlay" role="alertdialog" aria-hidden="true">
        <h2 id="fgOverlayTitle">Game Over</h2>
        <p>Skor anda: <strong id="fgFinalScore">0</strong></p>
        <button id="fgOverlayRestart" class="fg-btn">Main Semula</button>
      </div>
    </div>
  </div>

<script>
/* ====================================================
Â  Â Single-file app script â€” safe init after DOMContentLoaded
Â  Â (UI unchanged; only game behavior tuned & balloon wired)
Â  Â ==================================================== */
document.addEventListener('DOMContentLoaded', () => {
Â  // ---- util
Â  const $ = sel => document.querySelector(sel);
Â  const $$ = sel => Array.from(document.querySelectorAll(sel));
Â  const WA_NUMBER = '60192506999'; // Bro's WA in international format without +

Â  // ---- header buttons & small fixes
Â  $('#year').textContent = new Date().getFullYear();

Â  // openGamesBtn should scroll to lite-games (fixed - was gamesCard)
Â  $('#openGamesBtn').addEventListener('click', () => {
Â  Â  const tgt = document.getElementById('lite-games');
Â  Â  if (tgt) tgt.scrollIntoView({behavior:'smooth', block:'start'});
Â  });
Â  $('#openQuizBtn').addEventListener('click', () => {
Â  Â  const tgt = document.getElementById('quizSection');
Â  Â  if (tgt) tgt.scrollIntoView({behavior:'smooth', block:'start'});
Â  });

Â  /* =========================
Â  Â  Â WAKTU SOLAT & CUACAÂ  (same as before)
Â  Â  Â ========================= */
Â  const COORDS = {
Â  Â  "WLY01": [3.139, 101.6869], "WLY02": [2.9265, 101.6965, "WLY01"],
Â  Â  "SGR01": [3.0738, 101.5183], "PNG01": [5.4164, 100.3327],
Â  Â  "PRK01": [4.5975, 101.0901], "JHR01": [1.4927, 103.7414],
Â  Â  "KTN01": [6.1254, 102.2381], "KDH01": [6.1184, 100.3685],
Â  Â  "MLK01": [2.1896, 102.2501], "NSN01": [2.7258, 101.9424],
Â  Â  "PHG01": [3.8126, 103.3256], "PLS01": [6.4447, 100.2046],
Â  Â  "SBH01": [5.978, 116.0753], "SWK01": [1.5533, 110.3592],
Â  Â  "TRG01": [5.3302, 103.1408], "LBN01": [5.2831, 115.2308]
Â  };

Â  async function fetchWaktuFromESolat(zone) {
Â  Â  solatResult.textContent = ' Memuatkan waktu solat...';
Â  Â  const zoneToUse = (zone === 'WLY02') ? 'WLY01' : zone;
Â  Â  try {
Â  Â  Â  const r = await fetch(`https://www.e-solat.gov.my/index.php?r=esolatApi/takwimsolat&period=today&zone=${zoneToUse}`);
Â  Â  Â  const data = await r.json();
Â  Â  Â  if (data && data.prayerTime && data.prayerTime[0]) {
Â  Â  Â  Â  const d = data.prayerTime[0];
Â  Â  Â  Â  solatResult.innerHTML = `
Â  Â  Â  Â  Â  <strong> Zon: ${data.zone || zone}</strong><br>
Â  Â  Â  Â  Â   Subuh: <b>${d.fajr}</b> &nbsp;  Syuruk: <b>${d.syuruk || d.sunrise || '-'}</b><br>
Â  Â  Â  Â  Â   Zohor: <b>${d.dhuhr}</b><br>
Â  Â  Â  Â  Â   Asar: <b>${d.asr}</b><br>
Â  Â  Â  Â  Â   Maghrib: <b>${d.maghrib}</b><br>
Â  Â  Â  Â  Â   Isyak: <b>${d.isha}</b><br>
Â  Â  Â  Â  Â   <small>${d.date || d.Tarikh || '-'}</small>
Â  Â  Â  Â  `;
Â  Â  Â  } else {
Â  Â  Â  Â  throw new Error('Tiada data eSolat');
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  console.warn('eSolat failed', err);
Â  Â  Â  solatResult.textContent = ' Gagal memuatkan waktu solat (API eSolat).';
Â  Â  }
Â  }

Â  async function fetchCuacaByCoords(lat, lon){
Â  Â  cuacaResult.textContent = ' Memuatkan cuaca...';
Â  Â  try {
Â  Â  Â  const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`);
Â  Â  Â  const d = await r.json();
Â  Â  Â  if (d && d.current_weather) {
Â  Â  Â  Â  cuacaResult.innerHTML = ` ${d.current_weather.temperature}Â°C â€”  Kekuatan angin: ${d.current_weather.windspeed} km/h`;
Â  Â  Â  } else {
Â  Â  Â  Â  throw new Error('no weather');
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  console.warn('weather failed', err);
Â  Â  Â  cuacaResult.textContent = ' Gagal memuatkan cuaca.';
Â  Â  }
Â  }

Â  negeriSelect.addEventListener('change', () => {
Â  Â  const zone = negeriSelect.value;
Â  Â  if (!zone) return;
Â  Â  fetchWaktuFromESolat(zone);
Â  Â  const c = COORDS[zone];
Â  Â  if (c) fetchCuacaByCoords(c[0], c[1]);
Â  });

Â  btnDetect.addEventListener('click', () => {
Â  Â  if (!navigator.geolocation) { alert('Geolocation tidak disokong pada peranti ini.'); return; }
Â  Â  navigator.geolocation.getCurrentPosition(async pos => {
Â  Â  Â  const lat = pos.coords.latitude, lon = pos.coords.longitude;
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
Â  Â  Â  Â  const jd = await res.json();
Â  Â  Â  Â  const negeriName = jd.principalSubdivision || jd.city || jd.locality;
Â  Â  Â  Â  const zoneMap = {
Â  Â  Â  Â  Â  "Kuala Lumpur":"WLY01","Putrajaya":"WLY02","Selangor":"SGR01","Pulau Pinang":"PNG01","Perak":"PRK01",
Â  Â  Â  Â  Â  "Johor":"JHR01","Kelantan":"KTN01","Kedah":"KDH01","Melaka":"MLK01","Negeri Sembilan":"NSN01",
Â  Â  Â  Â  Â  "Pahang":"PHG01","Perlis":"PLS01","Sabah":"SBH01","Sarawak":"SWK01","Terengganu":"TRG01","Labuan":"LBN01"
Â  Â  Â  Â  };
Â  Â  Â  Â  let pickedZone = null;
Â  Â  Â  Â  for (const [k,v] of Object.entries(zoneMap)){
Â  Â  Â  Â  Â  if (negeriName && negeriName.toLowerCase().includes(k.toLowerCase())) { pickedZone = v; break; }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!pickedZone) { fetchCuacaByCoords(lat, lon); alert('Tidak dapat kenal pasti negeri secara automatik. Sila pilih negeri secara manual.'); return; }
Â  Â  Â  Â  negeriSelect.value = pickedZone;
Â  Â  Â  Â  fetchWaktuFromESolat(pickedZone);
Â  Â  Â  Â  fetchCuacaByCoords(lat, lon);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.warn('reverse geocode failed', err);
Â  Â  Â  Â  alert('Gagal detect lokasi secara automatik. Sila pilih negeri secara manual.');
Â  Â  Â  }
Â  Â  }, () => { alert('Akses lokasi ditolak. Sila pilih negeri secara manual.'); }, {timeout:10000});
Â  });

Â  /* =========================
Â  Â  Â PRODUK ZURICH - grid + modal + whatsapp form
Â  Â  Â ========================= */
Â  const produkList = [
Â  Â  { id:'zdrive', title:'Z-Drive Assist', desc:'Bantuan tepi jalan 24/7, towing & khidmat kecemasan.' },
Â  Â  { id:'zmotor', title:'Z-Motor', desc:'Pelan Takaful Motor untuk perlindungan kemalangan, kecurian & kebakaran.' },
Â  Â  { id:'zrider', title:'Z-Rider', desc:'Takaful khas untuk penunggang motosikal & skuter.' },
Â  Â  { id:'ztravel', title:'Z-Travel', desc:'Perlindungan perjalanan â€” kelewatan, kehilangan bagasi & kecemasan perubatan.' },
Â  Â  { id:'zpa', title:'Personal Accident', desc:'Perlindungan kemalangan diri 24/7.' },
Â  Â  { id:'zfirebiz', title:'Fire Takaful (Business)', desc:'Perlindungan premis perniagaan daripada kebakaran & kerugian aset.' }
Â  ];
Â  const grid = $('#produkGrid');
Â  produkList.forEach(p => {
Â  Â  const el = document.createElement('div');
Â  Â  el.className = 'produk-card';
Â  Â  el.dataset.id = p.id;
Â  Â  el.innerHTML = `<h4>${p.title}</h4><p>${p.desc}</p>`;
Â  Â  el.addEventListener('click', ()=> openProdukModal(p));
Â  Â  grid.appendChild(el);
Â  });

Â  const modalProduk = $('#modalProduk');
Â  const produkInfoBox = $('#produkInfoBox');
Â  const closeProduk = $('#closeProduk');
Â  const quoteForm = $('#quoteForm');
Â  const cancelQuote = $('#cancelQuote');

Â  function openProdukModal(p){
Â  Â  produkInfoBox.innerHTML = `<h3>${p.title}</h3><p>${p.desc}</p>`;
Â  Â  modalProduk.classList.add('show');
Â  Â  modalProduk.setAttribute('aria-hidden','false');
Â  Â  $('#q_nama').value = ''; $('#q_tel').value = ''; $('#q_email').value = ''; $('#q_msg').value = '';
Â  Â  quoteForm.dataset.product = p.title;
Â  }
Â  closeProduk.addEventListener('click', ()=> {
Â  Â  modalProduk.classList.remove('show');
Â  Â  modalProduk.setAttribute('aria-hidden','true');
Â  });
Â  window.addEventListener('click', e=> { if (e.target === modalProduk) { modalProduk.classList.remove('show'); modalProduk.setAttribute('aria-hidden','true'); }});
Â  cancelQuote.addEventListener('click', ()=> { modalProduk.classList.remove('show'); modalProduk.setAttribute('aria-hidden','true'); });

Â  quoteForm.addEventListener('submit', (e) => {
Â  Â  e.preventDefault();
Â  Â  const nama = $('#q_nama').value.trim();
Â  Â  const tel = $('#q_tel').value.trim();
Â  Â  const email = $('#q_email').value.trim();
Â  Â  const msg = $('#q_msg').value.trim();
Â  Â  const prod = quoteForm.dataset.product || 'Zurich Takaful';
Â  Â  const text = `Assalamualaikum, saya nak minta quotation produk ${prod}.%0ANama: ${nama}%0ATelefon: ${tel}%0AEmail: ${email}%0AMesej: ${msg}`;
Â  Â  window.open(`https://wa.me/${WA_NUMBER}?text=${text}`, '_blank');
Â  Â  produkInfoBox.insertAdjacentHTML('beforeend', `<p style="color:green;margin-top:8px"> Borang dibuka di WhatsApp</p>`);
Â  Â  setTimeout(()=>{ modalProduk.classList.remove('show'); modalProduk.setAttribute('aria-hidden','true'); }, 1800);
Â  });

Â  /* =========================
Â  Â  Â QUIZ
Â  Â  Â ========================= */
Â  const quizData = [
Â  Â  { q:"Apakah tujuan utama takaful?", o:["Tolong-menolong (mutual help)","Untung individu semata","Sistem insurans konvensional"], a:0 },
Â  Â  { q:"Produk mana sesuai untuk penunggang motosikal/skuter?", o:["Z-Rider","Z-Travel","Fire Takaful"], a:0 },
Â  Â  { q:"Apakah yang Z-Drive Assist tawarkan?", o:["Bantuan tepi jalan & towing","Takaful nyawa","Insurans rumah"], a:0 },
Â  Â  { q:"Apakah kelebihan takaful berbanding insurans konvensional?", o:["Konsep tolong-menolong & tabarru'","Bayaran premium lebih rendah sentiasa","Tiada klausa"], a:0 }
Â  ];
Â  let qIndex = 0, qScore = 0;
Â  const quizQ = $('#quizQuestion'), quizO = $('#quizOptions'), startQuizBtn = $('#startQuiz');

Â  function showQuizQuestion(){
Â  Â  const q = quizData[qIndex];
Â  Â  quizQ.textContent = q.q;
Â  Â  quizO.innerHTML = '';
Â  Â  q.o.forEach((opt, i) => {
Â  Â  Â  const b = document.createElement('button'); b.className='cta'; b.textContent = opt;
Â  Â  Â  b.addEventListener('click', () => {
Â  Â  Â  Â  if (i === q.a) qScore++;
Â  Â  Â  Â  qIndex++;
Â  Â  Â  Â  if (qIndex < quizData.length) showQuizQuestion();
Â  Â  Â  Â  else finishQuiz();
Â  Â  Â  });
Â  Â  Â  quizO.appendChild(b);
Â  Â  });
Â  }
Â  function finishQuiz(){
Â  Â  quizQ.innerHTML = ` Kuiz Tamat! Skor: <strong>${qScore}/${quizData.length}</strong>`;
Â  Â  quizO.innerHTML = `<button id="quizRestart" class="cta">Ulang Kuiz</button>`;
Â  Â  $('#quizRestart').addEventListener('click', ()=> {
Â  Â  Â  qIndex=0; qScore=0; startQuizBtn.style.display='inline-block'; quizQ.textContent='Tekan "Mula Kuiz" untuk mula.'; quizO.innerHTML='';
Â  Â  });
Â  }
Â  startQuizBtn.addEventListener('click', () => { startQuizBtn.style.display='none'; qIndex=0; qScore=0; showQuizQuestion(); });

Â  /* =========================
Â  Â  Â FRUIT SLICE GAME (tuned)Â  -- existing modal version (kept as-is)
Â  Â  Â ========================= */
Â  const openFruitGameBtn = $('#openFruitGame'); // may be undefined if not present; safe to keep
Â  const fruitModal = $('#fruitModal');
Â  const fgCanvas = $('#fruitCanvas');
Â  const fgPause = $('#fgPause'); const fgRestart = $('#fgRestart'); const fgClose = $('#fgClose');
Â  const fgScore = $('#fgScore'); const fgOverlay = $('#fgOverlay'); const fgFinalScore = $('#fgFinalScore'); const fgOverlayRestart = $('#fgOverlayRestart');

Â  // preload audio, reduce volumes slightly for nicer UX
Â  const S_SLICE = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_896b8b71f1.mp3?filename=slice-1.mp3');
Â  const S_POP = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_2f6b6b1.mp3?filename=pop-1.mp3');
Â  const S_BOMB = new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_f7a0b7b0.mp3?filename=explode-01.mp3');
Â  [S_SLICE, S_POP, S_BOMB].forEach(a => { a.volume = 0.7; a.preload = 'auto'; });

Â  // canvas setup for modal fruit (kept)
Â  let ctx = null, W=0, H=0, DPR=window.devicePixelRatio||1;
Â  function resizeFG(){
Â  Â  DPR = window.devicePixelRatio || 1;
Â  Â  fgCanvas.style.height = (window.innerHeight - 140) + 'px';
Â  Â  fgCanvas.style.width = '100%';
Â  Â  fgCanvas.width = fgCanvas.clientWidth * DPR;
Â  Â  fgCanvas.height = fgCanvas.clientHeight * DPR;
Â  Â  ctx = fgCanvas.getContext('2d');
Â  Â  ctx.setTransform(DPR,0,0,DPR,0,0);
Â  Â  W = fgCanvas.clientWidth; H = fgCanvas.clientHeight;
Â  }

Â  // game state (fruit modal) - kept as original tuned implementation
Â  let fruits = [], particles = [], slicePath = [], isRunning=false, isPaused=false, scoreFG=0, spawnTimer=0, spawnInterval=1100, lastTime=0;
Â  const FRUITS = [
Â  Â  { name:'apple', color:'#ff5252', r:38, pts:10 },
Â  Â  { name:'orange', color:'#ff9800', r:42, pts:12 },
Â  Â  { name:'watermelon', color:'#4caf50', r:52, pts:18 },
Â  Â  { name:'lemon', color:'#ffeb3b', r:36, pts:9 }
Â  ];
Â  const BOMB = { name:'bomb', color:'#333', r:40 };
Â  const rand = (a,b) => a + Math.random()*(b-a);

Â  function spawnItem(){
Â  Â  const isBomb = Math.random() < 0.05;
Â  Â  const x = rand(60, W-60);
Â  Â  const vx = rand(-60,60)/1000;
Â  Â  if (isBomb){
Â  Â  Â  fruits.push({type:BOMB, x, y: H + 80, vx, vy:-rand(480,700), r:BOMB.r, exploded:false});
Â  Â  } else {
Â  Â  Â  const t = FRUITS[Math.floor(Math.random()*FRUITS.length)];
Â  Â  Â  fruits.push({type:t, x, y:H+80, vx, vy:-rand(420,700), r:t.r, cut:false, pts:t.pts, color:t.color});
Â  Â  }
Â  }
Â  function spawnParticles(x,y,color){
Â  Â  for (let i=0;i<14;i++){
Â  Â  Â  particles.push({x,y,vx:rand(-300,300)/1000,vy:rand(-300,0)/1000,life:rand(500,1000),t:0,color});
Â  Â  }
Â  }
Â  function pointCircle(px,py,cx,cy,r){ const dx=px-cx, dy=py-cy; return dx*dx+dy*dy <= r*r; }

Â  function checkSlice(){
Â  Â  if (slicePath.length < 2) return;
Â  Â  const path = slicePath.slice(Math.max(0, slicePath.length-12));
Â  Â  for (const f of fruits){
Â  Â  Â  if (f.cut || (f.type.name==='bomb' && f.exploded)) continue;
Â  Â  Â  for (let i=1;i<path.length;i++){
Â  Â  Â  Â  const x1=path[i-1].x, y1=path[i-1].y, x2=path[i].x, y2=path[i].y;
Â  Â  Â  Â  for (let t=0; t<=1; t+=0.2){
Â  Â  Â  Â  Â  const sx = x1 + (x2-x1)*t, sy = y1 + (y2-y1)*t;
Â  Â  Â  Â  Â  if (pointCircle(sx,sy,f.x,f.y,f.r * 0.9)){
Â  Â  Â  Â  Â  Â  if (f.type.name==='bomb'){
Â  Â  Â  Â  Â  Â  Â  try { S_BOMB.currentTime=0; S_BOMB.play(); } catch(e) {}
Â  Â  Â  Â  Â  Â  Â  f.exploded=true; endFG(true); return;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  if (!f.cut){
Â  Â  Â  Â  Â  Â  Â  Â  f.cut=true;
Â  Â  Â  Â  Â  Â  Â  Â  scoreFG += f.pts || 10;
Â  Â  Â  Â  Â  Â  Â  Â  fgScore.textContent = scoreFG;
Â  Â  Â  Â  Â  Â  Â  Â  spawnParticles(f.x, f.y, f.color || f.type.color);
Â  Â  Â  Â  Â  Â  Â  Â  try { S_SLICE.currentTime=0; S_SLICE.play(); } catch(e) {}
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(()=> { try { S_POP.currentTime=0; S_POP.play(); } catch(e) {} }, 80);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (f.cut) break;
Â  Â  Â  }
Â  Â  }
Â  Â  fruits = fruits.filter(f => !f.cut);
Â  }

Â  const GRAVITY = 900;
Â  function updateEntities(dt){
Â  Â  for (const f of fruits){ f.vy += GRAVITY*(dt/1000); f.x += f.vx * dt; f.y += f.vy * dt; }
Â  Â  for (const p of particles){ p.vy += 1200*(dt/1000); p.x += p.vx * dt; p.y += p.vy * dt; p.t += dt; }
Â  Â  particles = particles.filter(p => p.t < p.life);
Â  Â  fruits = fruits.filter(f => (f.y - f.r) <= (H + 100));
Â  }

Â  function draw(){
Â  Â  if (!ctx) return;
Â  Â  ctx.clearRect(0,0,W,H);
Â  Â  for (const f of fruits){
Â  Â  Â  ctx.save(); ctx.translate(f.x, f.y);
Â  Â  Â  ctx.beginPath(); ctx.arc(6,6,f.r+6,0,Math.PI*2); ctx.fillStyle='rgba(0,0,0,0.14)'; ctx.fill();
Â  Â  Â  ctx.beginPath(); ctx.arc(0,0,f.r,0,Math.PI*2);
Â  Â  Â  ctx.fillStyle = f.color || f.type.color; ctx.fill();
Â  Â  Â  ctx.beginPath(); ctx.ellipse(-f.r*0.35, -f.r*0.35, f.r*0.3, f.r*0.18, 0, 0, Math.PI*2);
Â  Â  Â  ctx.fillStyle = 'rgba(255,255,255,0.18)'; ctx.fill();
Â  Â  Â  if (f.type.name==='bomb'){ ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(0,0,f.r*0.55,0,Math.PI*2); ctx.fill();
Â  Â  Â  Â  ctx.fillStyle='#fff'; ctx.font=`${Math.max(14, Math.floor(f.r*0.45))}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('',0,0);
Â  Â  Â  }
Â  Â  Â  ctx.restore();
Â  Â  }
Â  Â  for (const p of particles){ ctx.beginPath(); ctx.arc(p.x, p.y, 4,0,Math.PI*2); ctx.fillStyle = p.color || '#fff'; ctx.fill(); }

Â  Â  if (slicePath.length){
Â  Â  Â  for (let i=1;i<slicePath.length;i++){
Â  Â  Â  Â  const a = i / slicePath.length;
Â  Â  Â  Â  ctx.beginPath(); ctx.moveTo(slicePath[i-1].x, slicePath[i-1].y); ctx.lineTo(slicePath[i].x, slicePath[i].y);
Â  Â  Â  Â  ctx.lineWidth = 6 * (0.6 + 0.4*a);
Â  Â  Â  Â  ctx.strokeStyle = `rgba(255,255,255,${0.15 + 0.8*a})`; ctx.lineCap='round'; ctx.stroke();
Â  Â  Â  }
Â  Â  }
Â  }

Â  function loop(ts){
Â  Â  if (!isRunning) return;
Â  Â  const dt = Math.min(40, ts - lastTime); lastTime = ts;
Â  Â  if (!isPaused){
Â  Â  Â  spawnTimer += dt;
Â  Â  Â  if (spawnTimer > spawnInterval){ spawnTimer = 0; spawnInterval = rand(800,1600); spawnItem(); }
Â  Â  Â  updateEntities(dt); checkSlice();
Â  Â  }
Â  Â  draw();
Â  Â  requestAnimationFrame(loop);
Â  }

Â  // input handling for modal fruit
Â  let drawing = false;
Â  function addPoint(x,y){ slicePath.push({x,y,t:Date.now()}); if (slicePath.length>30) slicePath.shift(); }
Â  function startDraw(x,y){ drawing=true; slicePath = [{x,y,t:Date.now()}]; addPoint(x,y); }
Â  function moveDraw(x,y){ if(!drawing) return; addPoint(x,y); }
Â  function endDraw(){ drawing=false; setTimeout(()=>slicePath=[],200); }

Â  fgCanvas.addEventListener('mousedown', e => {
Â  Â  const r = fgCanvas.getBoundingClientRect();
Â  Â  startDraw( (e.clientX - r.left) * (fgCanvas.width/fgCanvas.clientWidth) / DPR, (e.clientY - r.top) * (fgCanvas.height/fgCanvas.clientHeight) / DPR );
Â  });
Â  fgCanvas.addEventListener('mousemove', e => {
Â  Â  const r = fgCanvas.getBoundingClientRect();
Â  Â  moveDraw( (e.clientX - r.left) * (fgCanvas.width/fgCanvas.clientWidth) / DPR, (e.clientY - r.top) * (fgCanvas.height/fgCanvas.clientHeight) / DPR );
Â  });
Â  window.addEventListener('mouseup', () => endDraw());
Â  fgCanvas.addEventListener('touchstart', e => {
Â  Â  e.preventDefault(); const t = e.touches[0]; const r = fgCanvas.getBoundingClientRect();
Â  Â  startDraw( (t.clientX - r.left) * (fgCanvas.width/fgCanvas.clientWidth) / DPR, (t.clientY - r.top) * (fgCanvas.height/fgCanvas.clientHeight) / DPR );
Â  }, {passive:false});
Â  fgCanvas.addEventListener('touchmove', e => {
Â  Â  e.preventDefault(); const t = e.touches[0]; const r = fgCanvas.getBoundingClientRect();
Â  Â  moveDraw( (t.clientX - r.left) * (fgCanvas.width/fgCanvas.clientWidth) / DPR, (t.clientY - r.top) * (fgCanvas.height/fgCanvas.clientHeight) / DPR );
Â  }, {passive:false});
Â  fgCanvas.addEventListener('touchend', e => { e.preventDefault(); endDraw(); }, {passive:false});

Â  function startFG(){
Â  Â  // reset
Â  Â  fruits = []; particles = []; slicePath = []; scoreFG = 0; fgScore.textContent = '0';
Â  Â  spawnTimer = 0; spawnInterval = 1100; isRunning = true; isPaused = false; fgOverlay.classList.remove('show');
Â  Â  lastTime = performance.now();
Â  Â  requestAnimationFrame(loop);
Â  }
Â  function pauseFG(){ isPaused = !isPaused; fgPause.textContent = isPaused ? ' Main' : ' Jeda'; }
Â  function endFG(bomb=false){
Â  Â  isRunning = false;
Â  Â  fgFinalScore.textContent = scoreFG;
Â  Â  document.getElementById('fgOverlayTitle').textContent = bomb ? 'Boom! Game Over ' : 'Game Over';
Â  Â  fgOverlay.classList.add('show');
Â  }

Â  // wire UI for modal fruit: open/close/restart/pause
Â  if (openFruitGameBtn) {
Â  Â  openFruitGameBtn.addEventListener('click', () => {
Â  Â  Â  fruitModal.classList.add('show'); fruitModal.setAttribute('aria-hidden','false');
Â  Â  Â  resizeFG(); startFG();
Â  Â  });
Â  }
Â  if (fgClose) fgClose.addEventListener('click', () => { fruitModal.classList.remove('show'); fruitModal.setAttribute('aria-hidden','true'); isRunning=false; });
Â  if (fgRestart) fgRestart.addEventListener('click', () => { startFG(); });
Â  if (fgPause) fgPause.addEventListener('click', () => { pauseFG(); });
Â  if (fgOverlayRestart) fgOverlayRestart.addEventListener('click', () => { fgOverlay.classList.remove('show'); startFG(); });

Â  function resizeFG(){
Â  Â  DPR = window.devicePixelRatio || 1;
Â  Â  fgCanvas.style.height = (window.innerHeight - 140) + 'px';
Â  Â  fgCanvas.style.width = '100%';
Â  Â  fgCanvas.width = fgCanvas.clientWidth * DPR;
Â  Â  fgCanvas.height = fgCanvas.clientHeight * DPR;
Â  Â  ctx = fgCanvas.getContext('2d');
Â  Â  ctx.setTransform(DPR,0,0,DPR,0,0);
Â  Â  W = fgCanvas.clientWidth; H = fgCanvas.clientHeight;
Â  }
Â  window.addEventListener('resize', () => { if (fruitModal.classList.contains('show')) resizeFG(); });

Â  // allow Esc to close modals
Â  document.addEventListener('keydown', (e)=>{
Â  Â  if (e.key === 'Escape'){
Â  Â  Â  if (modalProduk.classList.contains('show')) { modalProduk.classList.remove('show'); modalProduk.setAttribute('aria-hidden','true'); }
Â  Â  Â  if (fruitModal.classList.contains('show')) { fruitModal.classList.remove('show'); fruitModal.setAttribute('aria-hidden','true'); isRunning=false; }
Â  Â  }
Â  });

Â  /* =========================
Â  Â  Â BALLOON POP GAME (inline in lite-games) - Rainbow Edition
Â  Â  Â ========================= */
Â  let balloonInterval = null;
Â  let activeRises = [];
Â  // use S_POP preloaded (exists) as pop sound; fallback to a CDN if needed
Â  const BALLOON_POP = S_POP || new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_2f6b6b1.mp3?filename=pop-1.mp3');
Â  BALLOON_POP.volume = 0.75;

Â  function startBalloonGame() {
Â  Â  // stop any previous first
Â  Â  stopBalloonGame();

Â  Â  const area = document.getElementById("balloon-game");
Â  Â  if (!area) return;
Â  Â  area.innerHTML = ""; // clear
Â  Â  activeRises = [];
Â  Â  let score = 0;
Â  Â  let gameOver = false;
Â  Â  let rainbowMode = false;

Â  Â  const scoreDisplay = document.createElement("div");
Â  Â  scoreDisplay.className = "score-display";
Â  Â  scoreDisplay.textContent = "Score: 0 ";
Â  Â  area.appendChild(scoreDisplay);

Â  Â  const rainbowBanner = document.createElement("div");
Â  Â  rainbowBanner.className = "rainbow-banner";
Â  Â  rainbowBanner.textContent = "";
Â  Â  area.appendChild(rainbowBanner);

Â  Â  // spawn
Â  Â  balloonInterval = setInterval(() => {
Â  Â  Â  if (gameOver) return;

Â  Â  Â  const balloon = document.createElement("div");
Â  Â  Â  balloon.className = "balloon";
Â  Â  Â  balloon.textContent = "";
Â  Â  Â  const size = 35 + Math.random() * 25;
Â  Â  Â  balloon.style.fontSize = `${size}px`;
Â  Â  Â  balloon.style.left = Math.random() * 85 + "%";
Â  Â  Â  balloon.style.bottom = "0px";
Â  Â  Â  balloon.style.userSelect = "none";

Â  Â  Â  if (rainbowMode) {
Â  Â  Â  Â  const hue = Math.floor(Math.random() * 360);
Â  Â  Â  Â  balloon.style.filter = `drop-shadow(0 0 8px hsl(${hue},100%,65%))`;
Â  Â  Â  Â  balloon.style.color = `hsl(${hue},100%,60%)`;
Â  Â  Â  }

Â  Â  Â  const riseSpeed = rainbowMode ? 5 + Math.random() * 2 : 3 + Math.random() * 2;
Â  Â  Â  area.appendChild(balloon);

Â  Â  Â  let bottom = 0;
Â  Â  Â  const rise = setInterval(() => {
Â  Â  Â  Â  if (gameOver) {
Â  Â  Â  Â  Â  if (balloon.parentNode) balloon.remove();
Â  Â  Â  Â  Â  clearInterval(rise);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  bottom += riseSpeed;
Â  Â  Â  Â  balloon.style.bottom = bottom + "px";
Â  Â  Â  Â  if (bottom > 450) {
Â  Â  Â  Â  Â  if (balloon.parentNode) balloon.remove();
Â  Â  Â  Â  Â  clearInterval(rise);
Â  Â  Â  Â  }
Â  Â  Â  }, 40);

Â  Â  Â  activeRises.push(rise);

Â  Â  Â  balloon.addEventListener("click", () => {
Â  Â  Â  Â  // visual pop
Â  Â  Â  Â  balloon.style.transition = "transform 0.12s ease-out, opacity 0.12s";
Â  Â  Â  Â  balloon.style.transform = "scale(1.4)";
Â  Â  Â  Â  balloon.style.opacity = "0.9";
Â  Â  Â  Â  try { BALLOON_POP.currentTime = 0; BALLOON_POP.play(); } catch(e) {}
Â  Â  Â  Â  setTimeout(() => { if (balloon.parentNode) balloon.remove(); }, 130);
Â  Â  Â  Â  clearInterval(rise);
Â  Â  Â  Â  score++;
Â  Â  Â  Â  scoreDisplay.textContent = "Score: " + score + " ";

Â  Â  Â  Â  if (!rainbowMode && score >= 10) {
Â  Â  Â  Â  Â  rainbowMode = true;
Â  Â  Â  Â  Â  rainbowBanner.textContent = " RAINBOW MODE AKTIF!";
Â  Â  Â  Â  Â  rainbowBanner.style.animation = "glowText 1s infinite alternate";
Â  Â  Â  Â  }

Â  Â  Â  Â  if (score >= 30) {
Â  Â  Â  Â  Â  // end game
Â  Â  Â  Â  Â  endBalloonGame(" Anda berjaya pop 30 belon!");
Â  Â  Â  Â  Â  gameOver = true;
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }, 700);
Â  }

Â  function stopBalloonGame() {
Â  Â  try { clearInterval(balloonInterval); balloonInterval = null; } catch(e){}
Â  Â  if (activeRises && activeRises.length) activeRises.forEach(id => clearInterval(id));
Â  Â  activeRises = [];
Â  Â  const area = document.getElementById("balloon-game");
Â  Â  if (area) area.innerHTML = "";
Â  }

Â  function endBalloonGame(message) {
Â  Â  stopBalloonGame();
Â  Â  const area = document.getElementById("balloon-game");
Â  Â  if (!area) return;
Â  Â  const msg = document.createElement('div');
Â  Â  msg.className = 'end-msg';
Â  Â  msg.textContent = message || 'Game ended';
Â  Â  area.appendChild(msg);
Â  }

Â  /* =========================
Â  Â  Â GAME SWITCHER (global) - connects inline Lite Games buttons to logic
Â  Â  Â - keeps UI exactly as is; uses modal Fruit Slice and inline Balloon game
Â  Â  Â ========================= */
Â  function showGame(type) {
Â  Â  // ensure global access for inline onclicks
Â  Â  // hide/show relevant areas and stop/start games properly
Â  Â  const fruitArea = document.getElementById("fruit-game");
Â  Â  const balloonArea = document.getElementById("balloon-game");

Â  Â  // tidy up highlight classes on buttons (if present)
Â  Â  document.querySelectorAll('.btn-switch').forEach(b => b.classList.remove('active'));
Â  Â  // attempt to toggle active class for the clicked one (works with inline onclick attr)
Â  Â  try {
Â  Â  Â  const btn = document.querySelector(`.btn-switch[onclick="showGame('${type}')"]`);
Â  Â  Â  if (btn) btn.classList.add('active');
Â  Â  } catch(e){}

Â  Â  // stop balloon game first to avoid overlap
Â  Â  if (typeof stopBalloonGame === 'function') stopBalloonGame();

Â  Â  // close fruit modal if open
Â  Â  if (fruitModal && fruitModal.classList.contains('show')) {
Â  Â  Â  fruitModal.classList.remove('show'); fruitModal.setAttribute('aria-hidden','true');
Â  Â  Â  isRunning = false;
Â  Â  }

Â  Â  if (type === 'fruit') {
Â  Â  Â  // open the modal fruit (keeps UI structure: modal fullscreen as original)
Â  Â  Â  fruitModal.classList.add('show'); fruitModal.setAttribute('aria-hidden','false');
Â  Â  Â  // ensure canvas resized then start
Â  Â  Â  resizeFG();
Â  Â  Â  startFG();
Â  Â  } else if (type === 'balloon') {
Â  Â  Â  // show inline balloon area (the element exists in HTML)
Â  Â  Â  if (fruitArea) fruitArea.style.display = 'none';
Â  Â  Â  if (balloonArea) {
Â  Â  Â  Â  balloonArea.style.display = 'block';
Â  Â  Â  Â  startBalloonGame();
Â  Â  Â  }
Â  Â  }
Â  }

Â  // expose showGame globally so inline onclick attributes work
Â  window.showGame = showGame;

Â  // ensure initial state: do not auto-open anything; leave as is (user clicks)
Â  // But if you want to auto-open fruit by default in lite-games, uncomment:
Â  // showGame('fruit');

Â  // small helpful console log
Â  console.info('AZA Zurich app initialized â€” Fruit Slice & Balloon Pop wired.');
});
</script>
  <script src="script.js" defer></script>
  <!-- âœ… Tambah dua ni kat sini, sebelum </body> -->
  <script src="./fruitgame.js"></script>
  <script src="./balloongame.js"></script>
</body>
</html>

